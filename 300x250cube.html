<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flip Creative</title>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .ad-container {
      width: 300px;
      height: 250px;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .ad-cube {
      width: 100%;
      height: 100%;
      position: absolute;
      transform-style: preserve-3d;
      transition: transform 1s ease-in-out;
    }

    .cube-face {
      position: absolute;
      width: 300px;
      height: 250px;
      backface-visibility: hidden;
      pointer-events: none;
    }

    .cube-face a {
      display: block;
      width: 100%;
      height: 100%;
    }

    .cube-face img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .face-1 { transform: rotateY(0deg) translateZ(150px); }
    .face-2 { transform: rotateY(90deg) translateZ(150px); }
    .face-3 { transform: rotateY(180deg) translateZ(150px); }
    .face-4 { transform: rotateY(270deg) translateZ(150px); }
  </style>
</head>

<body>

<div class="ad-container" id="adContainer">
  <div class="ad-cube" id="adCube">

    <div class="cube-face face-1" data-creative="0">
      <a href="https://play.google.com/store/apps/details?id=com.coindcx.btc&hl=en_AU" data-impression="https://tracking.com/i1">
        <img src="https://ik.imagekit.io/gku4adhog/CoinDcx%20gif.gif" alt="CoinDcx" loading="lazy">
      </a>
    </div>

    <div class="cube-face face-2" data-creative="1">
      <a href="https://play.google.com/store/apps/details?id=com.coinswitch.kuber&hl=en_AU" data-impression="https://tracking.com/i2">
        <img src="https://ik.imagekit.io/gku4adhog/CoinSwitch%20gif.gif" alt="CoinDcx" loading="lazy">
      </a>
    </div>

    <div class="cube-face face-3" data-creative="2">
      <a href="https://www.eventcinemas.com.au/Movie/Dhurandhar" data-impression="https://tracking.com/i3">
        <img src="https://ik.imagekit.io/gku4adhog/Dhurandhar%20GIF.gif" alt="CoinDcx" loading="lazy">
      </a>
    </div>

    <div class="cube-face face-4" data-creative="3">
      <a href="https://play.google.com/store/apps/details?id=com.coinswitch.kuber&hl=en_AU" data-impression="https://tracking.com/i4">
        <img src="https://ik.imagekit.io/gku4adhog/BGMI%20GIF.gif" alt="CoinDcx" loading="lazy">
      </a>
    </div>
  </div>
</div>

<script>
  const firedImpressions = [];

  function fireImpression(index) {
    if (firedImpressions.includes(index)) return;
    const face = document.querySelector(`[data-creative="${index}"]`);
    if (!face) return;

    const url = face.querySelector("a").dataset.impression;
    if (url) {
      new Image().src = url;
      firedImpressions.push(index);
      console.log("Impression fired:", index);
    }
  }

  fireImpression(0);

  const adCube = document.getElementById("adCube");
  const adContainer = document.getElementById("adContainer");
  const faces = document.querySelectorAll(".cube-face");

  const ROTATION_INTERVAL = 2000;
  const totalFaces = 4;

  let rotationDegree = 0;
  let currentFace = 0;
  let rotationTimer = null;

  function updatePointerEvents(activeIndex) {
    faces.forEach((face, i) => {
      face.style.pointerEvents = i === activeIndex ? "auto" : "none";
    });
  }

  updatePointerEvents(0);

  function rotateCube() {
    stopRotation(); 

    rotationDegree -= 90;
    adCube.style.transform = `rotateY(${rotationDegree}deg)`;
    currentFace = (currentFace + 1) % totalFaces;

    adCube.addEventListener("transitionend", function handler() {
      updatePointerEvents(currentFace);
      fireImpression(currentFace);
      startRotation(); 
      adCube.removeEventListener("transitionend", handler);
    });
  }

  function startRotation() {
    if (rotationTimer) return;
    rotationTimer = setInterval(rotateCube, ROTATION_INTERVAL);
  }

  function stopRotation() {
    clearInterval(rotationTimer);
    rotationTimer = null;
  }

  startRotation();

  adContainer.addEventListener("mouseenter", stopRotation);
  adContainer.addEventListener("mouseleave", startRotation);

  document.addEventListener("click", function (e) {
    const link = e.target.closest("a[data-impression]");
    if (!link) return;

    e.preventDefault();
    stopRotation(); 

    const face = link.closest("[data-creative]");
    const index = parseInt(face.dataset.creative, 10);
    fireImpression(index);

    window.open(link.href, "_blank");
  });
</script>

</body>
</html>
